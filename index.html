<!DOCTYPE html> <html lang="en"> <head> <meta charset="UTF-8"> <meta name="viewport" content="width=device-width,initial-scale=1"> <title>PGlite Table Editor Demo</title> <style>body{font-family:Arial,sans-serif;background-color:#ebf2fa;color:#333;margin:0;padding:0;display:flex;justify-content:center;align-items:flex-start;height:100vh}.container{width:95%;max-width:1200px;margin-top:20px;background:#fff;border-radius:8px;box-shadow:0 4px 6px rgba(0,0,0,.1);overflow:hidden}.toolbar{background-color:#fff;border-bottom:2px solid #f0f0f0;padding:10px 20px;display:flex;justify-content:space-between;align-items:center}.toolbar button,.toolbar textarea{padding:8px 12px;border-radius:4px;border:2px solid #3182ce;background-color:#3182ce;color:#fff;font-size:14px;margin-right:8px;cursor:pointer}.toolbar textarea{width:100%;margin-right:8px;padding:8px;border-radius:4px;border:1px solid #ccc;background-color:#f7f7f7;color:#333;resize:vertical;font-size:14px;box-sizing:border-box}.toolbar button:hover{background-color:#2c5282}button:disabled,textarea:disabled{color:#999;background-color:#ddd;border-color:#ccc;cursor:not-allowed}table{width:100%;border-collapse:collapse;table-layout:fixed}td,th{padding:12px 20px;border-bottom:1px solid #e2e8f0;text-align:left;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}th{background-color:#3182ce;color:#fff}td.editable{cursor:pointer;background-color:#f0f0f0}.status{padding:10px 20px;background-color:#f7f7f7;color:#2c5282;border-top:1px solid #e2e8f0}</style> </head> <body> <div class="container"> <div class="toolbar"> <div> <button id="addRowButton" disabled>Stage New Row</button> <button id="submitChangesButton" style="display:none">Submit Changes</button> <button id="refreshButton" disabled>Refresh Table</button> </div> <div> <textarea id="ddlInput" placeholder="Enter DDL command here" rows="4">CREATE TABLE IF NOT EXISTS test (id SERIAL PRIMARY KEY, message TEXT);</textarea> <button id="updateDDLButton">Update DDL & Reinitialize DB</button> </div> <div> <textarea id="sqlInput" placeholder="Enter SQL command here" rows="4" disabled>select 1;</textarea> <button id="executeSqlButton" disabled>Execute SQL</button> </div> </div> <table id="dataTable"> </table> <div class="status" id="status">Initializing...</div> </div> <script type="module">import{PGlite}from"https://cdn.jsdelivr.net/npm/@electric-sql/pglite/dist/index.js";const addRowButton=document.getElementById("addRowButton"),statusElement=document.getElementById("status"),submitChangesButton=document.getElementById("submitChangesButton"),dataTable=document.getElementById("dataTable"),sqlInput=document.getElementById("sqlInput"),ddlInput=document.getElementById("ddlInput");let db=null,stagedRows=[];async function updateDDLAndReinitializeDB(){const t=ddlInput.value.trim();t?(await nukeIndexedDB(),await initializeDB(t)):setStatus("No DDL command entered.")}function enableUI(){document.getElementById("addRowButton").disabled=!1,document.getElementById("refreshButton").disabled=!1,document.getElementById("executeSqlButton").disabled=!1,document.getElementById("sqlInput").disabled=!1}function disableUI(){document.getElementById("addRowButton").disabled=!0,document.getElementById("refreshButton").disabled=!0,document.getElementById("executeSqlButton").disabled=!0,document.getElementById("sqlInput").disabled=!0}async function nukeIndexedDB(){await window.indexedDB.databases().then((t=>{for(let e=0;e<t.length;e++)window.indexedDB.deleteDatabase(t[e].name)}))}async function initializeDB(t="CREATE TABLE IF NOT EXISTS test (id SERIAL PRIMARY KEY, message TEXT);"){disableUI(),setStatus("Initializing database..."),db=new PGlite("idb://my-pgdata"),await db.query(t),setStatus("Database initialized and table ensured."),enableUI(),fetchTableData()}function setStatus(t){console.log(t),statusElement.textContent=t}function showSubmitChangesButton(t=!0){submitChangesButton.style.display=t?"inline-block":"none"}function showAddRowButton(t=!0){addRowButton.style.display=t?"inline-block":"none"}async function fetchTableData(){setStatus("Fetching table data...");const t=await db.query("SELECT * FROM test;");populateTable(t.rows,t.fields,!0),showSubmitChangesButton(!1),setStatus("Table data fetched.")}function populateTable(t,e,n){showAddRowButton(n),dataTable.innerHTML=`<tr>${e.map((t=>`<th>${t.name}</th>`)).join("")}</tr>`,t.forEach((t=>{const a=`<tr>${e.map((e=>`<td class="${n?"editable":""}" contenteditable="${n}">${t[e.name]}</td>`)).join("")}</tr>`;dataTable.innerHTML+=a})),n&&attachChangeEventToEditableCells()}function attachChangeEventToEditableCells(){dataTable.addEventListener("input",(t=>{"TD"===t.target.tagName&&t.target.classList.contains("editable")&&showSubmitChangesButton(!0)}))}function stageNewRow(){setStatus("Staging new row for addition...");const t={id:"new",message:"New Message"};stagedRows.push(t),populateTable([...Array.from(dataTable.querySelectorAll("tr")).slice(1).map((t=>({id:t.cells[0].innerText,message:t.cells[1].innerText}))),t],[{name:"id"},{name:"message"}],!0),showSubmitChangesButton(!0)}async function submitChanges(){setStatus("Submitting changes, including staged rows..."),await db.query("BEGIN;");try{const t=dataTable.querySelectorAll("tr");for(let e=1;e<t.length;e++){const n=t[e].cells[0].innerText,a=t[e].cells[1].innerText;"new"===n?await db.query("INSERT INTO test (message) VALUES ($1);",[a]):await db.query("UPDATE test SET message = $1 WHERE id = $2;",[a,n])}await db.query("COMMIT;"),stagedRows=[],fetchTableData()}catch(t){await db.query("ROLLBACK;"),setStatus(`Error submitting changes: ${t.message}`)}}async function executeSQL(){const t=sqlInput.value.trim();if(t){setStatus(`Executing SQL: ${t}`);try{const e=await db.query(t);if(t.toLowerCase().startsWith("select")){const n=/from\s+test\b/i.test(t);populateTable(e.rows,e.fields,!!n),setStatus(`SQL executed. Rows returned: ${e.rows.length}.`)}else fetchTableData(),setStatus(`SQL executed. Rows affected: ${e.affectedRows??"N/A"}.`)}catch(t){setStatus(`Error executing SQL: ${t.message}`)}showSubmitChangesButton(!1)}else setStatus("No SQL command entered.")}addRowButton.onclick=stageNewRow,submitChangesButton.onclick=submitChanges,document.getElementById("refreshButton").onclick=fetchTableData,document.getElementById("executeSqlButton").onclick=executeSQL,document.getElementById("updateDDLButton").onclick=updateDDLAndReinitializeDB,window.onload=()=>initializeDB(ddlInput.value.trim());</script> 